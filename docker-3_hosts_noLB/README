LiveAgent docker infra setup for 3 servers with LB only on the 1st one, mysql on 1st and 2nd (master-master replication with backup set up on 2nd), redis on 1st and 2nd, elasticsearch on all 3.

Prerequisites:

* 3 physical/virtual hosts with enough RAM, CPU and disk space
* CENTOS 7 with SUDO privileges on all hosts
* compatible LA version (The newest should do)

Build info

    DO EVERY STEP ON ALL HOSTS UNTIL TOLD OTHERWISE
1.  Install GIT (yum install git)
2.  Create valid ssl.crt and ssl.key files in /opt/LiveAgent-Docker/docker-3_hosts_noLB/
3.  Modify config.sh file and enter all requested info
4.  Run config.sh file in /opt/LiveAgent-Docker/docker-3_hosts_noLB/ with "chmod +x ./config.sh && ./config.sh
5.  Enter "production/docker" directory on each host and run install_utils.sh script with "chmod +x ./install_utils.sh && ./install_utils.sh"
6.  Run docker-compose on each host after step 7 is done "/usr/local/bin/docker-compose up -d"

7.  Set up database and replication on hosts 1 and 2:

-    run docker exec -it mysql bash on both hosts
-    run mysql and then source /tmp/initdb.sql; on both hosts
-    exit mysql shell and enter mysql.bin number and position to other host /tmp/replication.sql in container (Info from first host enter to second and vice versa)
-    enter mysql shell on both hosts again and run source /tmp/replication.sql;
-    verify if replications are set on both hosts via show slave status\G (both Slave_IO_Running and Slave_SQL_Running must be Yes without errors)
-    run source /tmp/createdb.sql; on the first host

8.  Restart haproxy and xinetd on 1st host and only xinetd on 2nd and 3rd - "service xinetd restart && docker restart haproxy"
9.  Open your site for LA setup (site you entered in config.sh), STOP AFTER YOU LOG IN TO YOUR AGENT PANEL
10. Run "after_install.sh" on all 3 hosts with "chmod +x ./after_install.sh && ./after_install" (on host 1 or 2 will this script report error about redis slave - it's OK)
11. Enter "your_private_ip:9000/haproxy_stats" into your browser, username: admin and password you entered in config.sh for haproxy and check if all hosts are UP except one redis host as sentinels choose which redis host is master
12. Enjoy

VERSION UPDATE

*  download/move new version of LA .zip file to "docker1" directory
*  run version_update.sh script - chmod +x version_update.sh && ./version_update.sh
*  follow instructions from the script

USEFUL DOCKER COMMANDS

*  docker --help        - all possible commands
*  docker ps            - diplay all running containers
*  docker ps -a         - display all containers
*  docker images        - display all images from which containers were build
*  docker start|stop|restart        - start, stop and restart container
*  docker rm|rmi        - remove container, remove image
*  docker volume prune  - remove all unused volumes
*  docker stats         - CPU, MEMORY, I/O stats of containers
*  docker logs -t container_name    - display container logs
*  docker cp <container_id>:/path/to/useful/file /local-path      - (useful when container won't start)
*  docker exec -it container_name bash      - enter bash shell of container (examples of shells: bash, mysql, redis-cli...)
*  /usr/local/bin/docker-compose up -d      - will bring up all containers stated in docker-compose.yml, when you destroy any container and it's image and you want to build it from the scratch with the same or different settings

LIVEAGENT PLUGINS

*  PUBLIC_IP:10200 - put into IP address column when activating
*  unix:///var/run/clamav/clamd.sock - put into IP address column when activating
